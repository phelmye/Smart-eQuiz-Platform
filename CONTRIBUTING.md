# Contributing & Developer workflow

This repository provides a local-first developer workflow that includes a disposable Postgres instance, idempotent migrations and seeding, and a small auth E2E harness to validate login/refresh/logout behavior.

Local init (Windows PowerShell)

1. From the repo root run the helper that brings up the local stack and runs the one-shot init:

```powershell
Set-Location -Path "C:\Projects\Dev\Smart eQuiz Platform"
.\dev\run-init.ps1
```

2. After it completes, the API should be available at http://localhost:3000 and seeded with a demo org and user (`admin@demo.local`).

Running the quick auth smoke locally

```powershell
# Optionally set the env var so the refresh token is also returned in the response body for non-browser E2E
# $env:RETURN_REFRESH_IN_BODY='true'
node services/api/test/e2e/auth.e2e.js
```

Notes and safety
- `api-init` will run `prisma migrate reset` and seed the database. Only run it against local databases spun up by `dev/docker-compose.yml`.
- The GitHub Actions workflow `.github/workflows/ci-auth-smoke.yml` is manual and guarded. Review it before changing automation rules.

How to debug failures
- Collect `docker compose logs api postgres redis` and `docker compose ps` output.
- Check `services/api/logs` or the `api-init.log` generated by the helper.

If you open a PR, include a short description of how you validated migrations and seeding locally (or that you ran the auth smoke E2E).
# Contributing to Smart eQuiz Platform

This file describes how to develop locally, run migrations and seeds, and the preferred workflow for making changes without affecting CI/main until you're ready.

Local-first workflow

1. Create a local branch for WIP (do not push):

```powershell
git switch -c local/your-feature
```

2. Install local helper hooks (optional, recommended):

```powershell
cd <repo-root>
.\dev\install-hooks.ps1
```

This installs a pre-push guard that blocks pushes from branches starting with `local/` to prevent accidental pushes.

3. Reset, migrate, and seed the local DB (recommended for reproducible testing):

```powershell
# default: reset, apply migrations, seed
.\dev\reset-db.ps1

# reset but simulate CI Postgres image
.\dev\reset-db.ps1 -UseCiImage

# reset but don't seed
.\dev\reset-db.ps1 -Seed:$false
```

4. Run the frontend dev server (if working on UI):

```powershell
Set-Location workspace/shadcn-ui
npm install
npm run dev
```

Seeder notes

- The local seeder supports `--local` to seed into the local Postgres via `docker compose`.
- Use `--fresh` to truncate related tables before seeding, producing deterministic results for repeated runs.

CI and debug artifacts

- CI uses a CI-only compose override `dev/docker-compose.ci.yml` to run a Debian-based Postgres image in GitHub-hosted runners.
- Workflows collect debug artifacts only when `DEBUG_ARTIFACTS` is enabled or when the manual workflow's `collect_debug_artifacts` input is `true`.

When to push

- Keep work on `local/*` branches until ready to publish.
- When you want to create a PR, create a new feature branch (not `local/*`) and push that branch. If needed, rebase or squash WIP commits before pushing.

Questions

If anything here is unclear or you'd like different guard behavior (for example a server-side check or GitHub policy), open an issue or ping the maintainers.
